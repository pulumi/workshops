# 1. Intro

## Setup

1. Ensure you have completed the [Workshop setup directions](../README.md)

## Steps

### Step 1

1. Create an empty folder 

    ```
    $ mkdir ~/qconlondon/
    ```

1. Create a new Pulumi project

    ```
    $ pulumi new
    ```

    Pick the `aws-typescript` template, and use the `eu-west-1` region.  Say `yes` at the end to deploy the example.

1. Open the code in your editor/IDE (like [Code](https://code.visualstudio.com/download))

    ```
    $ code .
    ```

1. Check out the files generated by the template:

    * `index.ts` for your Pulumi program
    * `package.json` and `tsconfig.json` for Node and TypeScript configuration
    * `Pulumi.yaml` and `Pulumi.dev.yaml` for your Pulumi project and stack configuration

1. Visit the Pulumi console

    Open the link that was printed at the end of your first deployment in your browser.

    ```
    $ open https://app.pulumi.com/lukehoban/qconlondon/dev/updates/1
    ```

    Checkout the Activity and Resource tabs.  Click the link on your bucket to view it in the AWS Console.

1. The end result of the steps so far is availble in the [step1](./step1) folder.

### Step 2


1. Turn on bucket versioning

    Change the `new aws.s3.Bucket` line to this:

    ```typescript
    const bucket = new aws.s3.Bucket("my-bucket", {
        versioning: {
            enabled: true,
        }
    });
    ```

1. Deploy the changes

    ```
    pulumi up
    ```

1. The end result of the steps so far is availble in the [step2](./step2) folder.

### Step 3

1. Add two imports at the top of your `index.ts` file:

    ```typescript
    import { readdirSync } from "fs";
    import { join } from "path";
    ```

1. Type in the following code after the `new aws.s3.Bucket` line:

    ```typescript
    const folder = "./files";
    const files = readdirSync(folder);
    for (const file of files) {
        const fileSource = new pulumi.asset.FileAsset(join(folder, file));
        new aws.s3.BucketObject(file, {
            bucket: bucket,
            key: file,
            source: fileSource,
        });
    }
    ```

1. Create a folder with content to upload

    ```
    $ mkdir files
    
    $ <create some files in the `files` folder>
    ```

1. Deploy the changes

    ```
    pulumi up
    ```

1. The end result of the steps so far is availble in the [step3](./step3) folder.