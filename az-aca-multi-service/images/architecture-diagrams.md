# Architecture Progression: Basic â†’ Native â†’ Dapr

This document shows how the infrastructure evolves across the three workshop stages.

---

## 1. infra-basic - Simple Setup

The foundation: both apps publicly accessible, direct communication.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Azure Subscription                                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Resource Group: rg-todo-demo-dev                      â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Container Apps Environment                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Backend App     â”‚  â”‚  Frontend App      â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (.NET 8 API)    â”‚  â”‚  (React + BFF)     â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  ğŸŒ PUBLIC       â”‚  â”‚  ğŸŒ PUBLIC         â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Port: 8080      â”‚  â”‚  Port: 8080        â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         â†‘                      â”‚                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         â”‚                      â””â”€â”€â”€Direct HTTPS â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         â”‚                          call         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚            â”‚                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Storage Account â”‚      â”‚ Container Registry   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚      â”‚ (ACR)                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Blob Container: â”‚      â”‚                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  board-state/   â”‚      â”‚ todo-backend:latest  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ board.json  â”‚      â”‚ todo-frontend:latest â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚           â–²                                         â”‚ â”‚
â”‚  â”‚           â”‚                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚ â”‚
â”‚  â”‚  â”‚ Managed Identityâ”‚                               â”‚ â”‚
â”‚  â”‚  â”‚ (Backend's ID)  â”‚                               â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Characteristics:**
- Both apps publicly accessible
- Simple direct communication
- No resiliency policies
- Good for learning basics

---

## 2. infra-native - Private Backend + Resiliency

Adding security and resilience without Dapr.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Azure Subscription                                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Resource Group: rg-todo-demo-dev                      â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Container Apps Environment                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  (Internal network for service discovery)       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Backend App     â”‚  â”‚  Frontend App      â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (.NET 8 API)    â”‚  â”‚  (React + BFF)     â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ”’ INTERNAL     â”‚â—„â”€â”¤  ğŸŒ PUBLIC         â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Port: 8080      â”‚  â”‚  Port: 8080        â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                  â”‚  â”‚                    â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Failure: 30%     â”‚  â”‚ Calls via internal â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                  â”‚  â”‚ FQDN (*.internal.*) â”‚  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         â†‘                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         â”‚                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ âœ¨ AppResiliency Policy â”‚ â† NEW!            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Retry: 3x exponential â”‚                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Timeout: 30s          â”‚                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Circuit Breaker: 5    â”‚                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Storage Account â”‚      â”‚ Container Registry   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚      â”‚ (ACR)                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Blob Container: â”‚      â”‚                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  board-state/   â”‚      â”‚ todo-backend:latest  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ board.json  â”‚      â”‚ todo-frontend:latest â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚         â”‚                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                     â”‚ â”‚
â”‚  â”‚  â”‚ Managed     â”‚                                     â”‚ â”‚
â”‚  â”‚  â”‚ Identity    â”‚                                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Changes:**
- ğŸ”’ Backend is internal-only (not publicly accessible)
- âœ¨ AppResiliency policy handles retries/timeouts/circuit breaking
- ğŸ“¡ Frontend uses internal FQDN for service discovery
- ğŸ”¥ Backend simulates 30% failure rate to demonstrate resilience

---

## 3. infra-dapr - Webhooks with Pub/Sub

Adding event-driven architecture for webhook ingestion.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Azure Subscription                                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Resource Group: rg-todo-demo-dev                      â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚  â”‚ ğŸ¯ Azure Service Bus     â† NEW!              â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    Topic: external-tasks                     â”‚    â”‚ â”‚
â”‚  â”‚  â”‚    (buffers webhook events)                  â”‚    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                 â”‚                                     â”‚ â”‚
â”‚  â”‚                 â”‚ Dapr Pub/Sub Component              â”‚ â”‚
â”‚  â”‚                 â–¼                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Container Apps Environment                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Backend App       â”‚  â”‚  Frontend App      â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  (.NET 8 API)      â”‚  â”‚  (React + BFF)     â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ”’ INTERNAL       â”‚â—„â”€â”¤  ğŸŒ PUBLIC         â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Port: 8080        â”‚  â”‚  Port: 8080        â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                    â”‚  â”‚                    â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ No Dapr            â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â”‚ ğŸ”· Dapr Sidecarâ”‚ â”‚  â”‚ (native calls)     â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â”‚ Pub/Sub enabledâ”‚ â”‚  â”‚                    â”‚â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ /dapr/subscribe    â”‚                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ /events/tasks      â”‚                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Storage Account â”‚      â”‚ Container Registry   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                 â”‚      â”‚                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Blob Container: â”‚      â”‚                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  board-state/   â”‚      â”‚ todo-backend:latest  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€ board.json  â”‚      â”‚ todo-frontend:latest â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚         â”‚                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                     â”‚ â”‚
â”‚  â”‚  â”‚ Managed     â”‚                                     â”‚ â”‚
â”‚  â”‚  â”‚ Identity    â”‚                                     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚  External Webhooks â”€â”€â–º Service Bus â”€â”€â–º Dapr â”€â”€â–º Backend    â”‚
â”‚  (GitHub, Slack, etc)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Changes:**
- ğŸ¯ Azure Service Bus added for webhook event buffering
- ğŸ”· Backend has Dapr sidecar enabled for pub/sub
- ğŸ“¬ Decoupled architecture: webhooks â†’ queue â†’ processing
- ğŸ”Œ Frontend still uses native calls (no Dapr needed)

**Event Flow:**
```
External System (GitHub)
         â”‚
         â”œâ”€â–º Webhook POST
         â”‚
         â–¼
   Service Bus Topic
    (external-tasks)
         â”‚
         â”œâ”€â–º Dapr Pub/Sub Component
         â”‚
         â–¼
  Backend /events/tasks
         â”‚
         â”œâ”€â–º Process event
         â”‚
         â–¼
   Create Todo Item
```

---

## Comparison Table

| Feature | infra-basic | infra-native | infra-dapr |
|---------|-------------|--------------|------------|
| Backend access | ğŸŒ Public | ğŸ”’ Internal | ğŸ”’ Internal |
| Communication | Direct HTTPS | Internal FQDN | Internal FQDN + Pub/Sub |
| Resiliency | None | AppResiliency policy | AppResiliency policy |
| Dapr | No | No | Yes (backend only) |
| Service Bus | No | No | Yes |
| Complexity | Low | Low | Medium |
| Use case | Basic demo | Production-ready | Webhook ingestion |

---

## Decision Guide

**Use infra-basic when:**
- Learning Container Apps basics
- Quick prototypes
- Both services can be public

**Use infra-native when:**
- Production deployments
- Backend should be private
- Need retry/timeout/circuit breaker policies
- Want simplest production setup

**Use infra-dapr when:**
- Need to receive webhooks while backend is private
- Want message buffering/queuing
- Need multi-cloud portability
- Building event-driven architectures

---

## Configuration Evolution: Hardcoded â†’ ESC

### The Problem: Secrets in Code

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Azure Container App                                   â”‚
â”‚                                                        â”‚
â”‚  Environment Variables (hardcoded in Pulumi):         â”‚
â”‚    SENDGRID_KEY: "SG.xxx..."  âš ï¸ In source control    â”‚
â”‚    DB_CONNECTION: "Server=..." âš ï¸ Visible in code     â”‚
â”‚    API_URL: "https://..."                             â”‚
â”‚                                                        â”‚
â”‚  Problems:                                            â”‚
â”‚  â€¢ Secrets visible in Pulumi code                     â”‚
â”‚  â€¢ Must redeploy to change config                     â”‚
â”‚  â€¢ Copy/paste between environments                    â”‚
â”‚  â€¢ No audit trail                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### The Solution: Pulumi ESC

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pulumi ESC (app.pulumi.com)                            â”‚
â”‚  âœ… Centralized, versioned, audited                     â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ESC Environment: todo-demo-dev                â”‚    â”‚
â”‚  â”‚                                                 â”‚    â”‚
â”‚  â”‚  values:                                        â”‚    â”‚
â”‚  â”‚    app:                                         â”‚    â”‚
â”‚  â”‚      Azure__UseStorage: "true"                  â”‚    â”‚
â”‚  â”‚                                                 â”‚    â”‚
â”‚  â”‚    secrets:                                     â”‚    â”‚
â”‚  â”‚      fn::open::azure-secrets:                   â”‚    â”‚
â”‚  â”‚        get:                                     â”‚    â”‚
â”‚  â”‚          sendgrid-key: ...  â† From Key Vault   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Pull config dynamically
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Azure Container Apps                                  â”‚
â”‚                                                         â”‚
â”‚  Backend & Frontend receive env vars from ESC          â”‚
â”‚  âœ… No secrets in source code                           â”‚
â”‚  âœ… Update config without redeploying                   â”‚
â”‚  âœ… Same config for local dev + production              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Benefits:**

- Zero secrets in code (dynamically fetched from Key Vault)
- Centralized config management across all environments
- Works in local dev: `pulumi env run todo-demo-dev -- npm run dev`
- Update config without redeploying infrastructure
